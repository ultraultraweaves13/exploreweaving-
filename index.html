<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rigid Heddle Weaving Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
 --bg:#F6F4F1;
 --card:#FFFFFF;
 --primary:#4A6F5E;
 --secondary:#4F7FA1;
 --warp:#4A6F5E;
 --weft:#4F7FA1;
 --text:#2E2E2E;
}
body{margin:0;font-family:Inter,sans-serif;background:var(--bg);color:var(--text);}
.container{max-width:900px;margin:auto;padding:28px 18px;}
h1,h2{font-family:"Libre Baskerville",serif;color:var(--primary);}
.card{background:var(--card);padding:20px;border-radius:10px;margin-bottom:22px;box-shadow:0 2px 6px rgba(0,0,0,.06);}
label{font-size:.85rem;margin-top:10px;display:block;}
select,input[type=number]{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd;}
input[type=range]{width:100%;}
button{margin-top:16px;padding:10px 18px;border-radius:6px;border:none;background:var(--primary);color:white;cursor:pointer;}
button:hover{background:#3e5f51;}
.small{font-size:.8rem;color:#666;}
.answer{background:#eef3f1;padding:14px;border-radius:8px;margin-top:14px;}
svg{max-width:260px;margin-top:8px;}
.hidden{display:none;}

@media print{
 body *{visibility:hidden;}
 #finalPage, #finalPage *{visibility:visible;}
 #finalPage{position:absolute;left:0;top:0;width:100%;}
}
</style>
</head>

<body>

<!-- ================= PAGE 1 ================= -->
<div class="container" id="plannerPage">
<h1>Rigid Heddle Weaving Planner</h1>

<div class="card">
<h2>1. Yarn & Structure</h2>

<label>Yarn</label>
<select id="yarn" onchange="applyYarn()"></select>

<label>Weave Structure</label>
<select id="structure" onchange="applyStructure()">
<option value="plain">Plain weave</option>
<option value="twill">2/2 Twill</option>
<option value="krok">Krokbragd</option>
<option value="double">Double weave</option>
</select>

<label>Reed setup</label>
<select id="reed" onchange="checkReed()">
<option value="single">Single reed</option>
<option value="double">Two reeds</option>
</select>

<div id="draftDiagram"></div>

<p class="small">
Draft shown is schematic for rigid heddle planning.
</p>
</div>

<div class="card">
<h2>2. Size</h2>

<label>Finished width (inches)</label>
<input id="width" type="number">

<label>Finished length (inches)</label>
<input id="length" type="number">

<label>EPI (suggested from yarn, editable)</label>
<input id="epi" type="number">

<label>Take-up + shrinkage (%)</label>
<input id="shrink" type="number" value="12">

<label>Loom waste (inches)</label>
<input id="waste" type="number" value="24">

<label>Sampling allowance: <span id="sampleVal">10%</span></label>
<input type="range" id="sample" min="0" max="30" value="10"
 oninput="sampleVal.textContent=this.value+'%'">

<button onclick="calculate()">Calculate Yarn</button>

<div class="answer" id="answerBox"></div>

<button onclick="showFinal()">View Final Project Plan</button>
</div>
</div>

<!-- ================= PAGE 2 ================= -->
<div class="container hidden" id="finalPage">
<h1>Final Weaving Plan</h1>

<div class="card">
<p><b>Yarn:</b> <span id="fYarn"></span></p>
<p><b>Structure:</b> <span id="fStructure"></span></p>
<p><b>Reed setup:</b> <span id="fReed"></span></p>
<p><b>EPI:</b> <span id="fEpi"></span></p>

<p><b>Total warp required:</b> <span id="fWarp"></span> m</p>
<p><b>Total weft required:</b> <span id="fWeft"></span> m</p>
<p><b>Total yarn required:</b> <span id="fTotal"></span> m</p>

<div id="finalDiagram"></div>

<button onclick="window.print()">Print Project Sheet</button>
<button onclick="back()">Back to Planner</button>
</div>
</div>

<script>
/* ---------------- YARN DATA ---------------- */
const yarns={
"Mercerised Cotton 5/2":{epi:18},
"Mercerised Cotton 10/2":{epi:24},
"Mercerised Cotton 20/2":{epi:30},
"Natural Dyed Cotton 5/2":{epi:16},
"Yoga Cotton 8/2":{epi:14},
"Cotton Linen 8/2":{epi:14},
"Hemp Rich Yarn":{epi:12},
"Cotton Sportweight":{epi:10},
"Cotton DK":{epi:8},
"Merino Cashmere 16/2":{epi:18},
"Cashmere 16/2":{epi:18},
"Mulberry Silk 16/2":{epi:20}
};

const ppiFactor={
plain:1,
twill:1,
krok:1.2,
double:2
};

/* ---------------- INIT ---------------- */
const yarnSel=document.getElementById("yarn");
Object.keys(yarns).forEach(y=>yarnSel.add(new Option(y,y)));

applyYarn();
applyStructure();

/* ---------------- LOGIC ---------------- */
function applyYarn(){
 epi.value=yarns[yarn.value].epi;
}

function applyStructure(){
 updateDraft();
 checkReed();
}

function checkReed(){
 if(reed.value==="double" && !["twill","double","krok"].includes(structure.value)){
  alert("Two reeds are typically used only for twill, double weave or krokbragd.");
  reed.value="single";
 }
}

function updateDraft(){
 let svg="<svg viewBox='0 0 120 120'>";
 for(let y=0;y<4;y++){
  for(let x=0;x<4;x++){
   let on=(structure.value==="plain")?((x+y)%2):(structure.value==="twill")?(x>=y):true;
   svg+=`<rect x="${x*30}" y="${y*30}" width="30" height="30"
    fill="${on?'var(--warp)':'var(--weft)'}"/>`;
  }
 }
 svg+="</svg>";
 draftDiagram.innerHTML=svg;
}

/* ---------------- CALCULATION ---------------- */
function calculate(){
 const widthIn=+width.value;
 const lengthIn=+length.value;
 const epiVal=+epi.value;
 const shrink=+shrink.value/100;
 const waste=+waste.value;
 const sample=+sample.value/100;

 const warpEnds=widthIn*epiVal;
 const warpLen=((lengthIn*(1+shrink))+waste)*0.0254;
 const warpM=warpEnds*warpLen;

 const ppi=epiVal*ppiFactor[structure.value];
 const weftM=(lengthIn*(1+shrink)*ppi*widthIn*(1+shrink))*0.0254;

 const total=(warpM+weftM)*(1+sample);

 answerBox.innerHTML=`
 <b>Warp:</b> ${warpM.toFixed(1)} m<br>
 <b>Weft:</b> ${weftM.toFixed(1)} m<br>
 <b>Total (incl. sampling):</b> ${total.toFixed(1)} m
 `;

 window.finalData={warpM,weftM,total};
}

/* ---------------- FINAL PAGE ---------------- */
function showFinal(){
 if(!window.finalData){alert("Please calculate first.");return;}
 plannerPage.classList.add("hidden");
 finalPage.classList.remove("hidden");

 fYarn.textContent=yarn.value;
 fStructure.textContent=structure.options[structure.selectedIndex].text;
 fReed.textContent=reed.value;
 fEpi.textContent=epi.value;
 fWarp.textContent=finalData.warpM.toFixed(1);
 fWeft.textContent=finalData.weftM.toFixed(1);
 fTotal.textContent=finalData.total.toFixed(1);

 finalDiagram.innerHTML=draftDiagram.innerHTML;
}

function back(){
 finalPage.classList.add("hidden");
 plannerPage.classList.remove("hidden");
}
</script>
</body>
</html>

